<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wang.ssm.dao.SsmMenuDao" >
  <resultMap id="BaseResultMap" type="com.wang.ssm.model.SsmMenu" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="icon" jdbcType="VARCHAR" property="icon" />
    <result column="createtime" jdbcType="VARCHAR" property="createtime" />
    <result column="creator" jdbcType="INTEGER" property="creator" />
    <result column="linkurl" jdbcType="VARCHAR" property="linkurl" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="menulevel" jdbcType="INTEGER" property="menulevel" />
    <result column="menuid" jdbcType="INTEGER" property="menuid" />
    <result column="sort" jdbcType="INTEGER" property="sort" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="checked" property="checked" jdbcType="INTEGER" />
    <collection property="children" column="id" select="getChildList" />  
  </resultMap>
  <resultMap id="TreeResultMap" type="com.wang.ssm.vo.TreeVO" >
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="text" jdbcType="VARCHAR" property="text" />
    <result column="checked" jdbcType="INTEGER" property="checked" />
    <result column="url" jdbcType="VARCHAR" property="url" />
    <result column="rid" jdbcType="INTEGER" property="rid" />
    <collection property="children" column="{id=id,rid=rid}" select="getTreeChildren" />  
  </resultMap>
  

  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, name, icon, createtime, creator, linkurl, status, menulevel, menuid, sort, description
  </sql>
  
 
  
<!--    <select id="getByMenuId" resultMap="BaseResultMap" parameterType="map">
  		 select
   m.id, m.name as name, m.icon as icon,
   m.createtime  as createtime, m.creator  as creator,
   m.linkurl  as linkurl, m.status  as status, m.menulevel  as menulevel, 
   m.menuid  as menuid, m.sort  as sort,m.description  as description, 	CASE WHEN(
		SELECT
			count(m2.id)
		FROM
			menu m2
		WHERE
			m2.menuid = m.id
			) 
		 > 0 THEN
			'closed'
		ELSE
				'open'
			END state
		from 
		menu m
		<where>
			status=1 
			<if test="parentId!=null">
				and m.menuid =  #{parentId,jdbcType=INTEGER}
			</if>
			 and m.menulevel=1
		</where>
		order by sort 
  </select> -->
  
  <select id="selectByExample" parameterType="com.wang.ssm.model.SsmMenuExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from menu
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from menu
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from menu
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.wang.ssm.model.SsmMenuExample">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from menu
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.wang.ssm.model.SsmMenu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into menu (name, icon, createtime, 
      creator, linkurl, status, 
      menulevel, menuid, sort, 
      description)
    values (#{name,jdbcType=VARCHAR}, #{icon,jdbcType=VARCHAR}, #{createtime,jdbcType=VARCHAR}, 
      #{creator,jdbcType=INTEGER}, #{linkurl,jdbcType=VARCHAR}, #{status,jdbcType=INTEGER}, 
      #{menulevel,jdbcType=INTEGER}, #{menuid,jdbcType=INTEGER}, #{sort,jdbcType=INTEGER}, 
      #{description,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.wang.ssm.model.SsmMenu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into menu
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="name != null">
        name,
      </if>
      <if test="icon != null">
        icon,
      </if>
      <if test="createtime != null">
        createtime,
      </if>
      <if test="creator != null">
        creator,
      </if>
      <if test="linkurl != null">
        linkurl,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="menulevel != null">
        menulevel,
      </if>
      <if test="menuid != null">
        menuid,
      </if>
      <if test="sort != null">
        sort,
      </if>
      <if test="description != null">
        description,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="icon != null">
        #{icon,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null">
        #{createtime,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="linkurl != null">
        #{linkurl,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="menulevel != null">
        #{menulevel,jdbcType=INTEGER},
      </if>
      <if test="menuid != null">
        #{menuid,jdbcType=INTEGER},
      </if>
      <if test="sort != null">
        #{sort,jdbcType=INTEGER},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.wang.ssm.model.SsmMenuExample" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from menu
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update menu
    <set>
      <if test="record.id != null">
        id = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.name != null">
        name = #{record.name,jdbcType=VARCHAR},
      </if>
      <if test="record.icon != null">
        icon = #{record.icon,jdbcType=VARCHAR},
      </if>
      <if test="record.createtime != null">
        createtime = #{record.createtime,jdbcType=VARCHAR},
      </if>
      <if test="record.creator != null">
        creator = #{record.creator,jdbcType=INTEGER},
      </if>
      <if test="record.linkurl != null">
        linkurl = #{record.linkurl,jdbcType=VARCHAR},
      </if>
      <if test="record.status != null">
        status = #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.menulevel != null">
        menulevel = #{record.menulevel,jdbcType=INTEGER},
      </if>
      <if test="record.menuid != null">
        menuid = #{record.menuid,jdbcType=INTEGER},
      </if>
      <if test="record.sort != null">
        sort = #{record.sort,jdbcType=INTEGER},
      </if>
      <if test="record.description != null">
        description = #{record.description,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update menu
    set id = #{record.id,jdbcType=INTEGER},
      name = #{record.name,jdbcType=VARCHAR},
      icon = #{record.icon,jdbcType=VARCHAR},
      createtime = #{record.createtime,jdbcType=VARCHAR},
      creator = #{record.creator,jdbcType=INTEGER},
      linkurl = #{record.linkurl,jdbcType=VARCHAR},
      status = #{record.status,jdbcType=INTEGER},
      menulevel = #{record.menulevel,jdbcType=INTEGER},
      menuid = #{record.menuid,jdbcType=INTEGER},
      sort = #{record.sort,jdbcType=INTEGER},
      description = #{record.description,jdbcType=VARCHAR}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.wang.ssm.model.SsmMenu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update menu
    <set>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="icon != null">
        icon = #{icon,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null">
        createtime = #{createtime,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        creator = #{creator,jdbcType=INTEGER},
      </if>
      <if test="linkurl != null">
        linkurl = #{linkurl,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="menulevel != null">
        menulevel = #{menulevel,jdbcType=INTEGER},
      </if>
      <if test="menuid != null">
        menuid = #{menuid,jdbcType=INTEGER},
      </if>
      <if test="sort != null">
        sort = #{sort,jdbcType=INTEGER},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.wang.ssm.model.SsmMenu">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update menu
    set name = #{name,jdbcType=VARCHAR},
      icon = #{icon,jdbcType=VARCHAR},
      createtime = #{createtime,jdbcType=VARCHAR},
      creator = #{creator,jdbcType=INTEGER},
      linkurl = #{linkurl,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      menulevel = #{menulevel,jdbcType=INTEGER},
      menuid = #{menuid,jdbcType=INTEGER},
      sort = #{sort,jdbcType=INTEGER},
      description = #{description,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  
  <select id="getListById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
  	select *,'open' as state , 1 as checked 
 	from menu m where  m.status=1 and m.id = #{id,jdbcType=INTEGER}
  </select>
  
  <select id="getTreeById" resultMap="TreeResultMap" parameterType="map">
 	SELECT
	id , name as text , linkurl as url , EXISTS(
		SELECT
			id
		FROM
			rolemenu rm where rm.menuid = m.id and rm.rid = #{rid,jdbcType=INTEGER}
		) AS checked , #{rid,jdbcType=INTEGER} as rid
	FROM
		menu m
	WHERE m.status=1 and
		m.id = #{id,jdbcType=INTEGER}
  </select>
  
   <select id="getTreeChildren" resultMap="TreeResultMap" parameterType="map">
 	SELECT
	id , name as text , linkurl as url , EXISTS(
		SELECT
			id
		FROM
			rolemenu rm where rm.menuid = m.id and rm.rid = #{rid,jdbcType=INTEGER}
		) AS checked , #{rid,jdbcType=INTEGER} as rid
	FROM
		menu m
	WHERE m.status=1 and
		m.menuid = #{id,jdbcType=INTEGER}
  </select>
  
   <select id="getChildList" resultMap="BaseResultMap" parameterType="java.lang.Integer">
  		 select
   *,CASE WHEN(
		SELECT
			count(m2.id)
		FROM
			menu m2
		WHERE
			m2.menuid = m.id
			) 
		 > 0 THEN
			'closed'
		ELSE
				'open'
			END state, 1 as checked 
		from 
		menu m
			where m.status=1 
				and m.menuid =  #{id,jdbcType=INTEGER}
		order by sort 
  </select>
</mapper>